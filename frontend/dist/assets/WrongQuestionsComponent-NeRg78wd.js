var e=(e,l,t)=>new Promise((a,s)=>{var u=e=>{try{o(t.next(e))}catch(l){s(l)}},n=e=>{try{o(t.throw(e))}catch(l){s(l)}},o=e=>e.done?a(e.value):Promise.resolve(e.value).then(u,n);o((t=t.apply(e,l)).next())});import{r as l,h as t,m as a,b as s,c as u,o as n,j as o,d as r,w as i,e as c,f as d,t as v,F as _,k as p,l as h,n as f,g as m,M as g}from"./index-DeV3sPN2.js";import{_ as y}from"./_plugin-vue_export-helper-BCo6x5W8.js";const w={class:"practice-container"},k={key:1},q={class:"practice-header"},b={class:"question-content"},x={class:"result-content"},C={key:0,class:"wrong-details"},$={class:"wrong-item"},j={class:"wrong-answer"},A={class:"correct-answer"},z={key:1,class:"correct-details"},V=y({__name:"WrongQuestionsComponent",emits:["switch-tab"],setup(y,{emit:V}){const D=V,E=l([]),I=l(0),P=l({}),U=l(!1),F=l({}),M=t(()=>E.value.length?E.value[I.value]:null),Q=t(()=>E.value.every(e=>void 0!==P.value[e.id]&&Array.isArray(P.value[e.id])&&P.value[e.id].length>0)),W=()=>e(this,null,function*(){try{const e=yield m.get("/api/wrong-questions");E.value=e.data.map(e=>e.question),P.value={},E.value.forEach(e=>{P.value[e.id]=[]})}catch(e){g.error("加载错题失败，请检查后端服务")}}),B=()=>{I.value<E.value.length-1&&I.value++},G=()=>{I.value>0&&I.value--},H=()=>e(this,null,function*(){try{const e={exam_id:`practice_${Date.now()}`,answers:{}};for(const t of E.value){const l=P.value[t.id];e.answers[t.id]=Array.isArray(l)?l.sort().join(""):l}const l=yield m.post("/api/wrong-questions/practice-submit",e);F.value={completed_count:l.data.total,correct_count:l.data.correct_count,score:l.data.score,wrong_questions:l.data.wrong_questions||[],correct_questions:l.data.correct_questions||[],results:l.data.results||[]},U.value=!0,g.success(`练习提交成功！正确率: ${l.data.score}%`)}catch(e){g.error("提交练习失败，请检查网络连接")}}),J=()=>{U.value=!1,I.value=0,P.value={},E.value.forEach(e=>{P.value[e.id]=[]})},K=()=>{D("switch-tab","exam")};return a(()=>{W()}),(e,l)=>{const t=s("t-icon"),a=s("t-button"),m=s("t-result"),g=s("t-card"),y=s("t-tag"),V=s("t-checkbox"),D=s("t-space"),W=s("t-checkbox-group"),L=s("t-list-item"),N=s("t-list"),O=s("t-dialog");return n(),u("div",w,[E.value&&0!==E.value.length?(n(),u("div",k,[r(g,null,{header:i(()=>[d("div",q,[l[4]||(l[4]=d("span",null,"错题练习",-1)),d("span",null,"进度: "+v(I.value+1)+"/"+v(E.value.length),1),r(y,{theme:"warning"},{default:i(()=>[...l[3]||(l[3]=[c("多选题",-1)])]),_:1})])]),footer:i(()=>[r(D,null,{default:i(()=>[r(a,{disabled:0===I.value,onClick:G},{default:i(()=>[...l[5]||(l[5]=[c(" 上一题 ",-1)])]),_:1},8,["disabled"]),I.value<E.value.length-1?(n(),o(a,{key:0,theme:"primary",onClick:B},{default:i(()=>[...l[6]||(l[6]=[c(" 下一题 ",-1)])]),_:1})):(n(),o(a,{key:1,theme:"success",onClick:H,disabled:!Q.value},{default:i(()=>[...l[7]||(l[7]=[c(" 提交练习 ",-1)])]),_:1},8,["disabled"]))]),_:1})]),default:i(()=>[d("div",b,[d("h3",null,v(M.value.question),1),r(W,{modelValue:P.value[M.value.id],"onUpdate:modelValue":l[0]||(l[0]=e=>P.value[M.value.id]=e)},{default:i(()=>[r(D,{direction:"vertical",size:"large"},{default:i(()=>[(n(!0),u(_,null,p(M.value.options,e=>(n(),o(V,{key:e.key,value:e.key,class:"option-item"},{default:i(()=>[c(v(e.key)+". "+v(e.text),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["modelValue"])])]),_:1})])):(n(),o(g,{key:0,class:"empty-card"},{default:i(()=>[r(m,{title:"暂无错题可练习",description:"继续保持全对！"},{icon:i(()=>[r(t,{name:"check-circle-filled",style:{color:"#00a870","font-size":"64px"}})]),operations:i(()=>[r(a,{theme:"primary",onClick:K},{default:i(()=>[...l[2]||(l[2]=[c("开始考试",-1)])]),_:1})]),_:1})]),_:1})),r(O,{visible:U.value,"onUpdate:visible":l[1]||(l[1]=e=>U.value=e),header:"练习结果",footer:null,width:"700px"},{default:i(()=>[d("div",x,[r(m,{title:`完成度: ${F.value.completed_count}/${E.value.length}`,description:`本次正确: ${F.value.correct_count} (正确率: ${F.value.score||0}%)`},{icon:i(()=>[r(t,{name:(F.value.score||0)>=60?"check-circle-filled":"error-circle-filled",style:f(`color: ${(F.value.score||0)>=60?"#00a870":"#e34d59"}; font-size: 64px;`)},null,8,["name","style"])]),_:1},8,["title","description"]),F.value.wrong_questions&&F.value.wrong_questions.length>0?(n(),u("div",C,[l[14]||(l[14]=d("h4",null,"错题详情：",-1)),r(N,null,{default:i(()=>[(n(!0),u(_,null,p(F.value.wrong_questions,e=>(n(),o(L,{key:e.question_id},{default:i(()=>[d("div",$,[d("p",null,[l[8]||(l[8]=d("strong",null,"题目ID:",-1)),c(" "+v(e.question_id),1)]),d("p",null,[l[9]||(l[9]=d("strong",null,"题目:",-1)),c(" "+v(e.question_text),1)]),d("p",null,[l[10]||(l[10]=d("strong",null,"你的答案:",-1)),l[11]||(l[11]=c()),d("span",j,v(e.user_answer||"未作答"),1)]),d("p",null,[l[12]||(l[12]=d("strong",null,"正确答案:",-1)),l[13]||(l[13]=c()),d("span",A,v(e.correct_answer),1)])])]),_:2},1024))),128))]),_:1})])):h("",!0),F.value.correct_questions&&F.value.correct_questions.length>0?(n(),u("div",z,[l[15]||(l[15]=d("h4",null,"答对题目：",-1)),(n(!0),u(_,null,p(F.value.correct_questions,e=>(n(),o(y,{key:e.question_id,theme:"success",class:"correct-tag"},{default:i(()=>[c(" 题目"+v(e.question_id),1)]),_:2},1024))),128))])):h("",!0),r(D,null,{default:i(()=>[r(a,{theme:"primary",onClick:J},{default:i(()=>[...l[16]||(l[16]=[c("继续练习",-1)])]),_:1}),r(a,{onClick:K},{default:i(()=>[...l[17]||(l[17]=[c("返回考试",-1)])]),_:1})]),_:1})])]),_:1},8,["visible"])])}}},[["__scopeId","data-v-11e90cf3"]]);export{V as default};
