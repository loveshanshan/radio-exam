import{r as e,a,b as s,c as l,o,d as r,w as d,e as t,f as n,g as u,M as p}from"./index-DeV3sPN2.js";import{_ as m}from"./_plugin-vue_export-helper-BCo6x5W8.js";const i={class:"password-change"},c=m({__name:"PasswordChangeComponent",emits:["success"],setup(m,{emit:c}){const w=e(!1),_=e(),f=a({old_password:"",new_password:"",confirm_password:""}),h={old_password:[{required:!0,message:"请输入当前密码"}],new_password:[{required:!0,message:"请输入新密码"},{min:6,message:"密码长度不能少于6位"},{max:50,message:"密码长度不能超过50位"}],confirm_password:[{required:!0,message:"请确认新密码"},{validator:e=>e===f.new_password,message:"两次输入的密码不一致"}]},g=c,v=()=>{return e=this,a=null,s=function*(){var e,a;if(yield _.value.validate()){w.value=!0;try{(yield u.post("/api/auth/change-password",{old_password:f.old_password,new_password:f.new_password})).data.success&&(p.success("密码修改成功"),y(),g("success"))}catch(s){const l=(null==(a=null==(e=s.response)?void 0:e.data)?void 0:a.error)||"修改密码失败";p.error(l)}finally{w.value=!1}}},new Promise((l,o)=>{var r=e=>{try{t(s.next(e))}catch(a){o(a)}},d=e=>{try{t(s.throw(e))}catch(a){o(a)}},t=e=>e.done?l(e.value):Promise.resolve(e.value).then(r,d);t((s=s.apply(e,a)).next())});var e,a,s},y=()=>{var e;f.old_password="",f.new_password="",f.confirm_password="",null==(e=_.value)||e.clearValidate()};return(e,a)=>{const u=s("t-input"),p=s("t-form-item"),m=s("t-icon"),c=s("t-button"),g=s("t-space"),b=s("t-form"),V=s("t-card");return o(),l("div",i,[r(V,null,{header:d(()=>[...a[3]||(a[3]=[n("h3",null,"修改密码",-1)])]),default:d(()=>[r(b,{ref_key:"passwordForm",ref:_,rules:h,data:f,onSubmit:v},{default:d(()=>[r(p,{label:"当前密码",name:"old_password"},{default:d(()=>[r(u,{modelValue:f.old_password,"onUpdate:modelValue":a[0]||(a[0]=e=>f.old_password=e),type:"password",placeholder:"请输入当前密码",maxlength:50},null,8,["modelValue"])]),_:1}),r(p,{label:"新密码",name:"new_password"},{default:d(()=>[r(u,{modelValue:f.new_password,"onUpdate:modelValue":a[1]||(a[1]=e=>f.new_password=e),type:"password",placeholder:"请输入新密码",maxlength:50},null,8,["modelValue"])]),_:1}),r(p,{label:"确认新密码",name:"confirm_password"},{default:d(()=>[r(u,{modelValue:f.confirm_password,"onUpdate:modelValue":a[2]||(a[2]=e=>f.confirm_password=e),type:"password",placeholder:"请再次输入新密码",maxlength:50},null,8,["modelValue"])]),_:1}),r(p,null,{default:d(()=>[r(g,{size:"large",class:"button-group"},{default:d(()=>[r(c,{theme:"primary",type:"submit",loading:w.value,size:"large",class:"submit-btn"},{default:d(()=>[r(m,{name:"check"}),a[4]||(a[4]=t(" 确认修改 ",-1))]),_:1},8,["loading"]),r(c,{theme:"default",onClick:y,size:"large",class:"reset-btn"},{default:d(()=>[r(m,{name:"refresh"}),a[5]||(a[5]=t(" 重置表单 ",-1))]),_:1})]),_:1})]),_:1})]),_:1},8,["data"])]),_:1})])}}},[["__scopeId","data-v-49a6aa9b"]]);export{c as default};
