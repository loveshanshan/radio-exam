var e=(e,t,l)=>new Promise((a,s)=>{var u=e=>{try{o(l.next(e))}catch(t){s(t)}},n=e=>{try{o(l.throw(e))}catch(t){s(t)}},o=e=>e.done?a(e.value):Promise.resolve(e.value).then(u,n);o((l=l.apply(e,t)).next())});import{r as t,h as l,m as a,b as s,c as u,o as n,j as o,d as i,w as r,e as c,f as d,t as v,F as _,k as p,l as h,n as m,g as f,M as g}from"./index-CtXrAt4g.js";import{_ as y}from"./_plugin-vue_export-helper-BCo6x5W8.js";const q={class:"practice-container"},k={key:1},w={class:"practice-header"},b={class:"question-content"},x={class:"result-content"},C={key:0,class:"wrong-details"},$={class:"wrong-item"},j={class:"wrong-answer"},A={class:"correct-answer"},z={key:1,class:"correct-details"},V={key:2,class:"removed-details"},D=y({__name:"WrongQuestionsComponent",emits:["switch-tab"],setup(y,{emit:D}){const E=D,I=t([]),P=t(0),U=t({}),F=t(!1),M=t({}),Q=t(!0),W=l(()=>I.value.length?I.value[P.value]:null),B=l(()=>I.value.every(e=>void 0!==U.value[e.id]&&Array.isArray(U.value[e.id])&&U.value[e.id].length>0)),G=()=>e(this,null,function*(){try{const e=yield f.get("/api/wrong-questions");I.value=e.data.map(e=>e.question),U.value={},I.value.forEach(e=>{U.value[e.id]=[]})}catch(e){g.error("加载错题失败，请检查后端服务")}}),H=()=>{P.value<I.value.length-1&&P.value++},J=()=>{P.value>0&&P.value--},K=()=>e(this,null,function*(){try{const e={exam_id:`practice_${Date.now()}`,answers:{}};for(const s of I.value){const t=U.value[s.id];e.answers[s.id]=Array.isArray(t)?t.sort().join(""):t}const t=yield f.post("/api/wrong-questions/practice-submit",e);M.value={completed_count:t.data.total,correct_count:t.data.correct_count,score:t.data.score,wrong_questions:t.data.wrong_questions||[],correct_questions:t.data.correct_questions||[],updated_questions:t.data.updated_questions||[],results:t.data.results||[]};const l=(t.data.updated_questions||[]).filter(e=>"removed"===e.action).length,a=t.data.total-l;Q.value=a>0,F.value=!0,g.success(`练习提交成功！正确率: ${t.data.score}%`)}catch(e){g.error("提交练习失败，请检查网络连接")}}),L=()=>e(this,null,function*(){F.value=!1,P.value=0,U.value={},yield G(),I.value.forEach(e=>{U.value[e.id]=[]})}),N=()=>{E("switch-tab","exam")};return a(()=>{G()}),(e,t)=>{const l=s("t-icon"),a=s("t-button"),f=s("t-result"),g=s("t-card"),y=s("t-tag"),D=s("t-checkbox"),E=s("t-space"),G=s("t-checkbox-group"),O=s("t-list-item"),R=s("t-list"),S=s("t-dialog");return n(),u("div",q,[I.value&&0!==I.value.length?(n(),u("div",k,[i(g,null,{header:r(()=>[d("div",w,[t[4]||(t[4]=d("span",null,"错题练习",-1)),d("span",null,"进度: "+v(P.value+1)+"/"+v(I.value.length),1),i(y,{theme:"warning"},{default:r(()=>[...t[3]||(t[3]=[c("多选题",-1)])]),_:1})])]),footer:r(()=>[i(E,null,{default:r(()=>[i(a,{disabled:0===P.value,onClick:J},{default:r(()=>[...t[5]||(t[5]=[c(" 上一题 ",-1)])]),_:1},8,["disabled"]),P.value<I.value.length-1?(n(),o(a,{key:0,theme:"primary",onClick:H},{default:r(()=>[...t[6]||(t[6]=[c(" 下一题 ",-1)])]),_:1})):(n(),o(a,{key:1,theme:"success",onClick:K,disabled:!B.value},{default:r(()=>[...t[7]||(t[7]=[c(" 提交练习 ",-1)])]),_:1},8,["disabled"]))]),_:1})]),default:r(()=>[d("div",b,[d("h3",null,v(W.value.question),1),i(G,{modelValue:U.value[W.value.id],"onUpdate:modelValue":t[0]||(t[0]=e=>U.value[W.value.id]=e)},{default:r(()=>[i(E,{direction:"vertical",size:"large"},{default:r(()=>[(n(!0),u(_,null,p(W.value.options,e=>(n(),o(D,{key:e.key,value:e.key,class:"option-item"},{default:r(()=>[c(v(e.key)+". "+v(e.text),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["modelValue"])])]),_:1})])):(n(),o(g,{key:0,class:"empty-card"},{default:r(()=>[i(f,{title:"暂无错题可练习",description:"继续保持全对！"},{icon:r(()=>[i(l,{name:"check-circle-filled",style:{color:"#00a870","font-size":"64px"}})]),operations:r(()=>[i(a,{theme:"primary",onClick:N},{default:r(()=>[...t[2]||(t[2]=[c("开始考试",-1)])]),_:1})]),_:1})]),_:1})),i(S,{visible:F.value,"onUpdate:visible":t[1]||(t[1]=e=>F.value=e),header:"练习结果",footer:null,width:"700px"},{default:r(()=>[d("div",x,[i(f,{title:`完成度: ${M.value.completed_count}/${I.value.length}`,description:`本次正确: ${M.value.correct_count} (正确率: ${M.value.score||0}%)`},{icon:r(()=>[i(l,{name:(M.value.score||0)>=60?"check-circle-filled":"error-circle-filled",style:m(`color: ${(M.value.score||0)>=60?"#00a870":"#e34d59"}; font-size: 64px;`)},null,8,["name","style"])]),_:1},8,["title","description"]),M.value.wrong_questions&&M.value.wrong_questions.length>0?(n(),u("div",C,[t[14]||(t[14]=d("h4",null,"错题详情：",-1)),i(R,null,{default:r(()=>[(n(!0),u(_,null,p(M.value.wrong_questions,e=>(n(),o(O,{key:e.question_id},{default:r(()=>[d("div",$,[d("p",null,[t[8]||(t[8]=d("strong",null,"题目ID:",-1)),c(" "+v(e.question_id),1)]),d("p",null,[t[9]||(t[9]=d("strong",null,"题目:",-1)),c(" "+v(e.question_text),1)]),d("p",null,[t[10]||(t[10]=d("strong",null,"你的答案:",-1)),t[11]||(t[11]=c()),d("span",j,v(e.user_answer||"未作答"),1)]),d("p",null,[t[12]||(t[12]=d("strong",null,"正确答案:",-1)),t[13]||(t[13]=c()),d("span",A,v(e.correct_answer),1)])])]),_:2},1024))),128))]),_:1})])):h("",!0),M.value.correct_questions&&M.value.correct_questions.length>0?(n(),u("div",z,[t[15]||(t[15]=d("h4",null,"答对题目：",-1)),(n(!0),u(_,null,p(M.value.correct_questions,e=>(n(),o(y,{key:e.question_id,theme:"success",class:"correct-tag"},{default:r(()=>[c(" 题目"+v(e.question_id),1)]),_:2},1024))),128))])):h("",!0),M.value.updated_questions&&M.value.updated_questions.length>0?(n(),u("div",V,[t[16]||(t[16]=d("h4",null,"已掌握题目：",-1)),(n(!0),u(_,null,p(M.value.updated_questions.filter(e=>"removed"===e.action),e=>(n(),o(y,{key:e.question_id,theme:"success",variant:"light",class:"removed-tag"},{default:r(()=>[c(" 题目"+v(e.question_id)+" (连续答对3次) ",1)]),_:2},1024))),128))])):h("",!0),i(E,null,{default:r(()=>[Q.value?(n(),o(a,{key:0,theme:"primary",onClick:L},{default:r(()=>[...t[17]||(t[17]=[c(" 继续练习 ",-1)])]),_:1})):(n(),o(a,{key:1,theme:"success",disabled:""},{default:r(()=>[...t[18]||(t[18]=[c(" 当前错题练习已完成 ",-1)])]),_:1})),i(a,{onClick:N},{default:r(()=>[...t[19]||(t[19]=[c("返回考试",-1)])]),_:1})]),_:1})])]),_:1},8,["visible"])])}}},[["__scopeId","data-v-32c346e2"]]);export{D as default};
