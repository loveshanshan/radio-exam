import{r as e,a,b as t,c as l,o as s,d as o,w as r,e as n,f as d,g as u,M as i}from"./index-DeV3sPN2.js";import{_ as c}from"./_plugin-vue_export-helper-BCo6x5W8.js";const m={class:"login-container"},p=c({__name:"LoginComponent",emits:["login-success"],setup(c,{emit:p}){const g=p,h=e(!1),f=e(),v=a({phone:"",password:""}),_={phone:[{required:!0,message:"请输入手机号"},{pattern:/^1[3-9]\d{9}$/,message:"请输入正确的手机号"}],password:[{required:!0,message:"请输入密码"},{min:6,message:"密码长度不能少于6位"}]},y=()=>{return e=this,a=null,t=function*(){var e,a;if(yield f.value.validate()){h.value=!0;try{const e=yield u.post("/api/auth/login",v);e.data.success&&(localStorage.setItem("token",e.data.token),localStorage.setItem("user",JSON.stringify(e.data.user)),u.defaults.headers.common.Authorization=`Bearer ${e.data.token}`,i.success("登录成功"),g("login-success",e.data.user))}catch(t){const l=(null==(a=null==(e=t.response)?void 0:e.data)?void 0:a.error)||"登录失败，请重试";i.error(l)}finally{h.value=!1}}},new Promise((l,s)=>{var o=e=>{try{n(t.next(e))}catch(a){s(a)}},r=e=>{try{n(t.throw(e))}catch(a){s(a)}},n=e=>e.done?l(e.value):Promise.resolve(e.value).then(o,r);n((t=t.apply(e,a)).next())});var e,a,t};return(e,a)=>{const u=t("t-input"),i=t("t-form-item"),c=t("t-button"),p=t("t-space"),g=t("t-form"),w=t("t-card");return s(),l("div",m,[o(w,{class:"login-card"},{header:r(()=>[...a[2]||(a[2]=[d("div",{class:"login-header"},[d("h2",null,"业余无线电考试系统"),d("p",null,"请登录以继续")],-1)])]),default:r(()=>[o(g,{ref_key:"loginForm",ref:f,rules:_,data:v,onSubmit:y},{default:r(()=>[o(i,{label:"手机号",name:"phone"},{default:r(()=>[o(u,{modelValue:v.phone,"onUpdate:modelValue":a[0]||(a[0]=e=>v.phone=e),placeholder:"请输入手机号",size:"large",maxlength:11},null,8,["modelValue"])]),_:1}),o(i,{label:"密码",name:"password"},{default:r(()=>[o(u,{modelValue:v.password,"onUpdate:modelValue":a[1]||(a[1]=e=>v.password=e),type:"password",placeholder:"请输入密码",size:"large"},null,8,["modelValue"])]),_:1}),o(i,null,{default:r(()=>[o(p,{direction:"vertical",size:"large",style:{width:"100%"}},{default:r(()=>[o(c,{type:"submit",theme:"primary",size:"large",loading:h.value,block:""},{default:r(()=>[...a[3]||(a[3]=[n(" 登录 ",-1)])]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["data"])]),_:1})])}}},[["__scopeId","data-v-62b8f759"]]);export{p as default};
