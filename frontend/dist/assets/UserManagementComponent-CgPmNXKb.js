var e=(e,a,l)=>new Promise((t,i)=>{var r=e=>{try{s(l.next(e))}catch(a){i(a)}},n=e=>{try{s(l.throw(e))}catch(a){i(a)}},s=e=>e.done?t(e.value):Promise.resolve(e.value).then(r,n);s((l=l.apply(e,a)).next())});import{r as a,a as l,m as t,b as i,c as r,o as n,d as s,w as u,j as o,l as d,e as m,t as c,f as v,g as p,M as _}from"./index-DeV3sPN2.js";import{_ as f}from"./_plugin-vue_export-helper-BCo6x5W8.js";const h={class:"user-management"},y={class:"management-header"},g=f({__name:"UserManagementComponent",setup(f){const g=a(!1),b=a(!1),w=a(!1),x=a(!1),k=a(!1),Y=a(!1),V=a(!1),M=a(!1),U=a(!1),z=a(null),C=a(),D=a(),H=a([]),K=l({current:1,pageSize:10,total:0}),$=l({phone:"",start_time:"",expire_time:""}),j=l({start_time:"",expire_time:""}),P={phone:[{required:!0,message:"请输入手机号"},{pattern:/^1[3-9]\d{9}$/,message:"请输入正确的手机号"}]},S=[{colKey:"user_id",title:"用户ID",width:120},{colKey:"phone",title:"手机号",width:150},{colKey:"is_admin",title:"角色",width:100},{colKey:"status",title:"状态",width:120},{colKey:"start_time",title:"开始时间",width:180},{colKey:"expire_time",title:"到期时间",width:180},{colKey:"created_at",title:"创建时间",width:180},{colKey:"operation",title:"操作",width:200}],F=()=>e(this,null,function*(){g.value=!0;try{const e=yield p.get("/api/auth/users");H.value=e.data.users,K.total=H.value.length}catch(e){_.error("加载用户列表失败")}finally{g.value=!1}}),I=()=>e(this,null,function*(){var e,a;if(yield C.value.validate()){b.value=!0;try{const e=yield p.post("/api/auth/register",$);e.data.success&&(_.success(`用户添加成功，默认密码: ${e.data.user.password}`),Y.value=!1,$.phone="",yield F())}catch(l){const t=(null==(a=null==(e=l.response)?void 0:e.data)?void 0:a.error)||"添加用户失败";_.error(t)}finally{b.value=!1}}}),q=()=>e(this,null,function*(){var e,a;w.value=!0;try{const e=yield p.post(`/api/auth/reset-password/${z.value.user_id}`);e.data.success&&(_.success(`密码重置成功: ${e.data.new_password}`),V.value=!1)}catch(l){const t=(null==(a=null==(e=l.response)?void 0:e.data)?void 0:a.error)||"重置密码失败";_.error(t)}finally{w.value=!1}}),A=()=>e(this,null,function*(){var e,a;x.value=!0;try{(yield p.delete(`/api/auth/users/${z.value.user_id}`)).data.success&&(_.success("用户删除成功"),M.value=!1,yield F())}catch(l){const t=(null==(a=null==(e=l.response)?void 0:e.data)?void 0:a.error)||"删除用户失败";_.error(t)}finally{x.value=!1}}),B=()=>e(this,null,function*(){var e,a;k.value=!0;try{(yield p.post(`/api/auth/update-user-time/${z.value.user_id}`,j)).data.success&&(_.success("用户时间限制更新成功"),U.value=!1,yield F())}catch(l){const t=(null==(a=null==(e=l.response)?void 0:e.data)?void 0:a.error)||"更新时间限制失败";_.error(t)}finally{k.value=!1}}),E=e=>{K.current=e.current,K.pageSize=e.pageSize};return t(()=>{F()}),(e,a)=>{const l=i("t-icon"),t=i("t-button"),p=i("t-tag"),_=i("t-space"),f=i("t-table"),F=i("t-card"),G=i("t-input"),J=i("t-form-item"),L=i("t-date-picker"),N=i("t-form"),O=i("t-alert"),Q=i("t-dialog");return n(),r("div",h,[s(F,null,{header:u(()=>[v("div",y,[a[11]||(a[11]=v("h3",null,"用户管理",-1)),s(t,{theme:"primary",onClick:a[0]||(a[0]=e=>Y.value=!0)},{icon:u(()=>[s(l,{name:"add"})]),default:u(()=>[a[10]||(a[10]=m(" 添加用户 ",-1))]),_:1})])]),default:u(()=>[s(f,{data:H.value,columns:S,loading:g.value,"row-key":"user_id",pagination:K,onPageChange:E},{is_admin:u(({row:e})=>[s(p,{theme:e.is_admin?"primary":"default"},{default:u(()=>[m(c(e.is_admin?"管理员":"普通用户"),1)]),_:2},1032,["theme"])]),status:u(({row:e})=>[s(_,{direction:"vertical",size:"small"},{default:u(()=>[s(p,{theme:"active"===e.status?"success":"danger"},{default:u(()=>[m(c("active"===e.status?"正常":"禁用"),1)]),_:2},1032,["theme"]),e.is_admin||"expired"!==e.access_status?d("",!0):(n(),o(p,{key:0,theme:"danger",size:"small"},{default:u(()=>[...a[12]||(a[12]=[m(" 已过期 ",-1)])]),_:1})),e.is_admin||void 0===e.days_left||null===e.days_left?d("",!0):(n(),o(p,{key:1,theme:e.days_left<=7?"warning":"success",size:"small"},{default:u(()=>[m(" 剩余"+c(e.days_left)+"天 ",1)]),_:2},1032,["theme"]))]),_:2},1024)]),operation:u(({row:e})=>[s(_,null,{default:u(()=>[e.is_admin?d("",!0):(n(),o(t,{key:0,theme:"primary",variant:"text",size:"small",onClick:a=>{return l=e,z.value=l,j.start_time=l.start_time||"",j.expire_time=l.expire_time||"",void(U.value=!0);var l}},{default:u(()=>[...a[13]||(a[13]=[m(" 设置时间 ",-1)])]),_:1},8,["onClick"])),e.is_admin?d("",!0):(n(),o(t,{key:1,theme:"warning",variant:"text",size:"small",onClick:a=>{return l=e,z.value=l,void(V.value=!0);var l}},{default:u(()=>[...a[14]||(a[14]=[m(" 重置密码 ",-1)])]),_:1},8,["onClick"])),e.is_admin?d("",!0):(n(),o(t,{key:2,theme:"danger",variant:"text",size:"small",onClick:a=>{return l=e,z.value=l,void(M.value=!0);var l}},{default:u(()=>[...a[15]||(a[15]=[m(" 删除 ",-1)])]),_:1},8,["onClick"]))]),_:2},1024)]),_:1},8,["data","loading","pagination"])]),_:1}),s(Q,{visible:Y.value,"onUpdate:visible":a[4]||(a[4]=e=>Y.value=e),header:"添加用户","on-confirm":I,"confirm-loading":b.value},{default:u(()=>[s(N,{ref_key:"addForm",ref:C,rules:P,data:$},{default:u(()=>[s(J,{label:"手机号",name:"phone"},{default:u(()=>[s(G,{modelValue:$.phone,"onUpdate:modelValue":a[1]||(a[1]=e=>$.phone=e),placeholder:"请输入手机号",maxlength:11},null,8,["modelValue"])]),_:1}),s(J,{label:"开始时间",name:"start_time"},{default:u(()=>[s(L,{modelValue:$.start_time,"onUpdate:modelValue":a[2]||(a[2]=e=>$.start_time=e),placeholder:"请选择开始时间（可选）",format:"YYYY-MM-DD HH:mm:ss","enable-time-picker":"",clearable:""},null,8,["modelValue"])]),_:1}),s(J,{label:"到期时间",name:"expire_time"},{default:u(()=>[s(L,{modelValue:$.expire_time,"onUpdate:modelValue":a[3]||(a[3]=e=>$.expire_time=e),placeholder:"请选择到期时间（可选）",format:"YYYY-MM-DD HH:mm:ss","enable-time-picker":"",clearable:""},null,8,["modelValue"])]),_:1})]),_:1},8,["data"]),s(O,{theme:"info",message:"新用户默认密码为: wxd666a"})]),_:1},8,["visible","confirm-loading"]),s(Q,{visible:V.value,"onUpdate:visible":a[5]||(a[5]=e=>V.value=e),header:"重置密码","on-confirm":q,"confirm-loading":w.value},{default:u(()=>{var e;return[v("p",null,[a[16]||(a[16]=m("确定要重置用户 ",-1)),v("strong",null,c(null==(e=z.value)?void 0:e.phone),1),a[17]||(a[17]=m(" 的密码吗？",-1))]),a[18]||(a[18]=v("p",null,[m("密码将重置为: "),v("strong",null,"wxd666a")],-1))]}),_:1},8,["visible","confirm-loading"]),s(Q,{visible:U.value,"onUpdate:visible":a[8]||(a[8]=e=>U.value=e),header:"设置用户时间限制","on-confirm":B,"confirm-loading":k.value},{default:u(()=>[s(N,{ref_key:"timeForm",ref:D,data:j},{default:u(()=>[s(J,{label:"用户"},{default:u(()=>{var e;return[s(G,{value:null==(e=z.value)?void 0:e.phone,disabled:""},null,8,["value"])]}),_:1}),s(J,{label:"开始时间"},{default:u(()=>[s(L,{modelValue:j.start_time,"onUpdate:modelValue":a[6]||(a[6]=e=>j.start_time=e),placeholder:"请选择开始时间（可选）",format:"YYYY-MM-DD HH:mm:ss","enable-time-picker":"",clearable:""},null,8,["modelValue"])]),_:1}),s(J,{label:"到期时间"},{default:u(()=>[s(L,{modelValue:j.expire_time,"onUpdate:modelValue":a[7]||(a[7]=e=>j.expire_time=e),placeholder:"请选择到期时间（可选）",format:"YYYY-MM-DD HH:mm:ss","enable-time-picker":"",clearable:""},null,8,["modelValue"])]),_:1})]),_:1},8,["data"])]),_:1},8,["visible","confirm-loading"]),s(Q,{visible:M.value,"onUpdate:visible":a[9]||(a[9]=e=>M.value=e),header:"删除用户","on-confirm":A,"confirm-loading":x.value},{default:u(()=>{var e;return[v("p",null,[a[19]||(a[19]=m("确定要删除用户 ",-1)),v("strong",null,c(null==(e=z.value)?void 0:e.phone),1),a[20]||(a[20]=m(" 吗？",-1))]),s(O,{theme:"warning",message:"此操作不可恢复！"})]}),_:1},8,["visible","confirm-loading"])])}}},[["__scopeId","data-v-b3b741cd"]]);export{g as default};
