var e=(e,a,l)=>new Promise((t,u)=>{var s=e=>{try{o(l.next(e))}catch(a){u(a)}},n=e=>{try{o(l.throw(e))}catch(a){u(a)}},o=e=>e.done?t(e.value):Promise.resolve(e.value).then(s,n);o((l=l.apply(e,a)).next())});import{r as a,h as l,i as t,b as u,c as s,o as n,j as o,d as i,w as r,f as c,e as d,t as v,F as _,k as m,l as p,n as h,g as f,M as g}from"./index-DeV3sPN2.js";import{_ as y}from"./_plugin-vue_export-helper-BCo6x5W8.js";const q={class:"exam-container"},x={key:1},w={class:"exam-header"},k={class:"question-content"},b={class:"result-content"},V={key:0,class:"wrong-details"},C={class:"wrong-item"},j={class:"wrong-answer"},U={class:"correct-answer"},$={key:1,class:"correct-details"},I=y({__name:"ExamComponent",emits:["switch-tab"],setup(y,{emit:I}){const z=I,A=a(null),D=a(0),E=a({}),M=a(!1),P=a({exam_id:"",total:0,correct_count:0,score:0,wrong_questions:[],results:[]}),F=a(!1),O=a(1),B=a(20),G=l(()=>A.value?A.value.questions[D.value]:null);t(G,e=>{e&&!E.value[e.id]&&(E.value[e.id]=[])});const H=()=>e(this,null,function*(){try{const e=yield f.get("/api/exam");e.data.questions&&e.data.questions.sort((e,a)=>e.id-a.id),A.value=e.data,D.value=0,E.value={}}catch(e){g.error("获取试卷失败")}}),J=()=>{F.value=!0},K=()=>e(this,null,function*(){try{const e=yield f.get("/api/exam/custom",{params:{start_id:O.value,count:B.value}});e.data.questions&&e.data.questions.sort((e,a)=>e.id-a.id),A.value=e.data,D.value=0,E.value={},F.value=!1}catch(e){g.error("获取试卷失败")}}),L=()=>{D.value<A.value.questions.length-1&&D.value++},N=()=>{D.value>0&&D.value--},Q=()=>e(this,null,function*(){try{const e={};Object.keys(E.value).forEach(a=>{const l=E.value[a];e[a]=Array.isArray(l)?l.sort().join(""):l});const a=yield f.post("/api/exam/submit",{exam_id:A.value.exam_id,answers:e});P.value={exam_id:a.data.exam_id||A.value.exam_id,total:a.data.total||A.value.questions.length,correct_count:a.data.correct_count||0,score:a.data.score||(a.data.correct_count&&a.data.total?Math.round(a.data.correct_count/a.data.total*100):0),wrong_questions:a.data.wrong_questions||[],results:a.data.results||[]},M.value=!0}catch(e){g.error("提交试卷失败")}}),R=()=>{A.value=null,M.value=!1,P.value={exam_id:"",total:0,correct_count:0,score:0,wrong_questions:[],results:[]}},S=()=>{M.value=!1,z("switch-tab","wrong")};return(e,a)=>{const l=u("t-button"),t=u("t-card"),f=u("t-tag"),g=u("t-checkbox"),y=u("t-space"),I=u("t-checkbox-group"),z=u("t-input-number"),T=u("t-form-item"),W=u("t-form"),X=u("t-dialog"),Y=u("t-icon"),Z=u("t-result"),ee=u("t-list-item"),ae=u("t-list");return n(),s("div",q,[A.value?(n(),s("div",x,[i(t,null,{header:r(()=>[c("div",w,[c("span",null,"题目ID: "+v(G.value.id),1),c("span",null,"进度: "+v(D.value+1)+"/"+v(A.value.questions.length),1),i(f,{theme:"warning"},{default:r(()=>[...a[9]||(a[9]=[d("多选题",-1)])]),_:1})])]),footer:r(()=>[i(y,null,{default:r(()=>[i(l,{disabled:0===D.value,onClick:N},{default:r(()=>[...a[10]||(a[10]=[d(" 上一题 ",-1)])]),_:1},8,["disabled"]),D.value<A.value.questions.length-1?(n(),o(l,{key:0,theme:"primary",onClick:L},{default:r(()=>[...a[11]||(a[11]=[d(" 下一题 ",-1)])]),_:1})):(n(),o(l,{key:1,theme:"success",onClick:Q},{default:r(()=>[...a[12]||(a[12]=[d(" 提交试卷 ",-1)])]),_:1}))]),_:1})]),default:r(()=>[c("div",k,[c("h3",null,v(G.value.question),1),i(I,{modelValue:E.value[G.value.id],"onUpdate:modelValue":a[0]||(a[0]=e=>E.value[G.value.id]=e)},{default:r(()=>[i(y,{direction:"vertical",size:"large"},{default:r(()=>[(n(!0),s(_,null,m(G.value.options,e=>(n(),o(g,{key:e.key,value:e.key,class:"option-item"},{default:r(()=>[d(v(e.key)+". "+v(e.text),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["modelValue"])])]),_:1})])):(n(),o(t,{key:0,class:"start-card"},{actions:r(()=>[i(l,{theme:"primary",onClick:H},{default:r(()=>[...a[5]||(a[5]=[d("开始考试",-1)])]),_:1}),i(l,{onClick:J},{default:r(()=>[...a[6]||(a[6]=[d("从指定题号开始",-1)])]),_:1})]),default:r(()=>[a[7]||(a[7]=c("p",null,"每次考试包含20道题目，全部完成后可提交",-1)),a[8]||(a[8]=c("p",{class:"exam-tip"},"所有题目均为多选题，请选择所有正确答案",-1))]),_:1})),i(X,{visible:F.value,"onUpdate:visible":a[3]||(a[3]=e=>F.value=e),header:"从指定题号开始","on-confirm":K},{default:r(()=>[i(W,null,{default:r(()=>[i(T,{label:"起始题号"},{default:r(()=>[i(z,{modelValue:O.value,"onUpdate:modelValue":a[1]||(a[1]=e=>O.value=e),min:1,max:1e3},null,8,["modelValue"])]),_:1}),i(T,{label:"题目数量"},{default:r(()=>[i(z,{modelValue:B.value,"onUpdate:modelValue":a[2]||(a[2]=e=>B.value=e),min:1,max:50},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["visible"]),i(X,{visible:M.value,"onUpdate:visible":a[4]||(a[4]=e=>M.value=e),header:"考试结果",footer:null,width:"700px"},{default:r(()=>[c("div",b,[i(Z,{title:`得分: ${P.value.score||0}`,description:`正确: ${P.value.correct_count||0}/${P.value.total||0} (正确率: ${P.value.score||0}%)`},{icon:r(()=>[i(Y,{name:(P.value.score||0)>=60?"check-circle-filled":"error-circle-filled",style:h(`color: ${(P.value.score||0)>=60?"#00a870":"#e34d59"}; font-size: 64px;`)},null,8,["name","style"])]),_:1},8,["title","description"]),P.value.wrong_questions&&P.value.wrong_questions.length>0?(n(),s("div",V,[a[19]||(a[19]=c("h4",null,"错题详情：",-1)),i(ae,null,{default:r(()=>[(n(!0),s(_,null,m(P.value.wrong_questions,e=>(n(),o(ee,{key:e.question_id},{default:r(()=>[c("div",C,[c("p",null,[a[13]||(a[13]=c("strong",null,"题目ID:",-1)),d(" "+v(e.question_id),1)]),c("p",null,[a[14]||(a[14]=c("strong",null,"题目:",-1)),d(" "+v(e.question_text),1)]),c("p",null,[a[15]||(a[15]=c("strong",null,"你的答案:",-1)),a[16]||(a[16]=d()),c("span",j,v(e.user_answer||"未作答"),1)]),c("p",null,[a[17]||(a[17]=c("strong",null,"正确答案:",-1)),a[18]||(a[18]=d()),c("span",U,v(e.correct_answer),1)])])]),_:2},1024))),128))]),_:1})])):p("",!0),P.value.correct_questions&&P.value.correct_questions.length>0?(n(),s("div",$,[a[20]||(a[20]=c("h4",null,"答对题目：",-1)),(n(!0),s(_,null,m(P.value.correct_questions,e=>(n(),o(f,{key:e.question_id,theme:"success",class:"correct-tag"},{default:r(()=>[d(" 题目"+v(e.question_id),1)]),_:2},1024))),128))])):p("",!0),i(y,null,{default:r(()=>[i(l,{theme:"primary",onClick:R},{default:r(()=>[...a[21]||(a[21]=[d("返回首页",-1)])]),_:1}),P.value.wrong_questions&&P.value.wrong_questions.length>0?(n(),o(l,{key:0,theme:"warning",onClick:S},{default:r(()=>[...a[22]||(a[22]=[d("练习错题",-1)])]),_:1})):p("",!0)]),_:1})])]),_:1},8,["visible"])])}}},[["__scopeId","data-v-c8fb73b7"]]);export{I as default};
